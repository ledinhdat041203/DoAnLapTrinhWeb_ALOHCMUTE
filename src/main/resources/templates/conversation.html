<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<title>Conversations</title>
	<link rel="icon" href="images/fav.png" type="image/png" sizes="16x16">

	<link rel="stylesheet" href="css/main.min.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/color.css">
	<link rel="stylesheet" href="css/responsive.css">

	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<script>
		localStorage.clear();
		$(document).ready(function () {
			$(document).on('click', '.load-chat', function (event) {
				// Bắt sự kiện click cho các liên kết
				event.preventDefault();

				var recvId = $(this).data('recv-id');
				var recvName = $(this).data('full-name');

				localStorage.setItem('recvId', recvId);
				localStorage.setItem('recvName', recvName);
				// Kiểm tra xem chat content đã được tải hay chưa
				if ($('#chat-frame').attr('data-recv-id') === recvId.toString()) {
					console.log('Chat content already loaded');
					return;
				}
				// Thực hiện cuộc gọi AJAX để tải nội dung chat
				$.ajax({
					type: 'GET',
					url: '/firebase',
					data: {uid: recvId},
					success: function (data) {
						// Thay đổi nội dung của #chat-container và cập nhật data-recv-id
						$('#chat-frame').html(data).attr('data-recv-id', recvId);
					},
					error: function () {
						alert('Error loading chat');
					}
				});

			});
		});
	</script>
	<script>
		function findByName() {
			const nameArea = document.getElementsByName("nameSearch");
			const name = nameArea[0].value;
			//alert(name);
			$.ajax({
				type: 'GET',
				url: '/findByName',
				data: {nameSearch: name},
				success: function (data) {
					//alert("Được rồi");
					console.log(data),
						// Thay đổi nội dung của #chat-container và cập nhật data-recv-id
						$('#listPeople').html(data);
				},
				error: function (error) {
					alert("Looix roi");
				}
			});
		}

	</script>

</head>

<body>


	<div class="theme-layout">
		<section>
			<div class="gap2 no-gap gray-bg">
				<div class="container-fluid no-padding">
					<div class="row">
						<div class="col-lg-12">
							<div class="message-users">
								<div class="message-head">
									<h4>Chat Messages</h4>
									<div class="more">
										<div class="more-post-optns"><i class="ti-settings"></i>
											<ul>
												<li><i class="fa fa-wrench"></i>Setting</li>
												<li><i class="fa fa-envelope-open"></i>Active Contacts</li>
												<li><i class="fa fa-folder-open"></i>Archives Chats</li>
												<li><i class="fa fa-eye-slash"></i>Unread Chats</li>
												<li><i class="fa fa-flag"></i>Report a problem</li>
											</ul>
										</div>
									</div>
								</div>
								<div class="message-people-srch">
									<form onsubmit="findByName(); return false;">
										<input type="text" placeholder="Search Friend.." name="nameSearch">
										<button><i class="fa fa-search"></i></button>
									</form>
									<div class="btn-group add-group" role="group">
										<button id="btnGroupDrop2" type="button"
											class="btn group dropdown-toggle user-filter" data-toggle="dropdown"
											aria-haspopup="true" aria-expanded="false">
											All
										</button>
										<div class="dropdown-menu" aria-labelledby="btnGroupDrop2">
											<a class="dropdown-item" href="#">Online</a>
											<a class="dropdown-item" href="#">Away</a>
											<a class="dropdown-item" href="#">unread</a>
											<a class="dropdown-item" href="#">archive</a>
										</div>
									</div>
									<div class="btn-group add-group align-right" role="group">
										<button id="btnGroupDrop1" type="button" class="btn group dropdown-toggle"
											data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
											Create+
										</button>
										<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
											<a class="dropdown-item" href="#">New user</a>
											<a class="dropdown-item" href="#">New Group +</a>
											<a class="dropdown-item" href="#">Private Chat +</a>
										</div>
									</div>
								</div>
								<div id="listPeople" class="mesg-peple">
									<ul class="nav nav-tabs nav-tabs--vertical msg-pepl-list">
										<li class="nav-item " th:each="item : ${list}" th:data-userid="${item.userID}">
											<a class="active load-chat" data-toggle="tab"
												th:attr="data-full-name=${item.fullName}, data-recv-id=${item.userID}">
												<figure><img src="images/resources/friend-avatar3.jpg" alt="">
													<span class="status f-online"></span>
												</figure>
												<div class="user-name">
													<h6 class="" th:text="${item.fullName}"></h6>
													<span>you send a video - 2hrs ago</span>
												</div>
												<div class="more">
													<div class="more-post-optns"><i class="ti-more-alt"></i>
														<ul>
															<li><i class="fa fa-bell-slash-o"></i>Mute</li>
															<li><i class="ti-trash"></i>Delete</li>
															<li><i class="fa fa-folder-open-o"></i>Archive</li>
															<li><i class="fa fa-ban"></i>Block</li>
															<li><i class="fa fa-eye-slash"></i>Ignore Message</li>
															<li><i class="fa fa-envelope"></i>Mark Unread</li>
														</ul>
													</div>
												</div>
											</a>
										</li>
									</ul>
								</div>
							</div>
							<div id="chat-frame" class="tab-content messenger">

							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>

	<script src="js/main.min.js"></script>
	<script src="js/script.js"></script>
	<div id="mm-blocker" class="mm-slideout"></div>

</body>

</html>